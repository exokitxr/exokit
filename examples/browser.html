<!doctype html>
<html>
  <body>
    <script src="three.js"></script>
    <script>
let renderer, scene, camera, iframe, planeMesh;

function init() {
  renderer = new THREE.WebGLRenderer({
    antialias: true,
    alpha: true,
  });
  renderer.setPixelRatio(window.devicePixelRatio);
  renderer.setSize(window.innerWidth, window.innerHeight);

  // window.browser.magicleap.RequestDepthPopulation(true);
  // renderer.autoClear = false;

  document.body.appendChild(renderer.domElement);

  renderer.setAnimationLoop(animate);

  scene = new THREE.Scene();
  scene.matrixAutoUpdate = false;
  // scene.background = new THREE.Color(0x3B3961);

  camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
  // camera.position.set(0, 1, 0);
  // camera.lookAt(new THREE.Vector3());
  scene.add(camera);

  const ambientLight = new THREE.AmbientLight(0x808080);
  scene.add(ambientLight);

  const directionalLight = new THREE.DirectionalLight(0xFFFFFF, 1);
  directionalLight.position.set(1, 1, 1);
  scene.add(directionalLight);

  iframe = document.createElement('iframe');
  iframe.d = 2;
  iframe.src = 'https://google.com';
  document.body.appendChild(iframe);

  planeMesh = (() => {
    const geometry = new THREE.PlaneBufferGeometry(0.9, 0.9)
      // .applyMatrix(new THREE.Matrix4().makeScale(-1, -1, 1));
    const uvs = geometry.attributes.uv.array;
    const numUvs = uvs.length / 2;
    for (let i = 0; i < numUvs; i++) {
      uvs[i*2+1] = 1 - uvs[i*2+1];
    }
    /* const material = new THREE.MeshPhongMaterial({
      color: 0xFFFF00,
    }); */
    const texture = new THREE.Texture(
      null,
      THREE.UVMapping,
      THREE.ClampToEdgeWrapping,
      THREE.ClampToEdgeWrapping,
      THREE.NearestFilter,
      THREE.NearestFilter,
      THREE.RGBAFormat,
      THREE.UnsignedByteType,
      16
    );
    const properties = renderer.properties.get(texture);
    properties.__webglTexture = iframe.texture;
    properties.__webglInit = true;
    const material = new THREE.MeshBasicMaterial({
      map: texture,
    });
    const mesh = new THREE.Mesh(geometry, material);
    mesh.position.z = -1;
    return mesh;
  })();
  scene.add(planeMesh);

  renderer.setAnimationLoop(animate);
}

init();

let direction = true;
function animate() {
  if (direction) {
    planeMesh.rotation.y += 0.01;

    if (planeMesh.rotation.y >= Math.PI/8) {
      direction = false;
    }
  } else {
    planeMesh.rotation.y -= 0.01;

    if (planeMesh.rotation.y <= -Math.PI/8) {
      direction = true;
    }
  }

  renderer.render(scene, camera);
}
    </script>
  </body>
</html>s
